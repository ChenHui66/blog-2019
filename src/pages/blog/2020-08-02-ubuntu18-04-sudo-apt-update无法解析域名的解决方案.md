---
layout: blog-post
draft: false
date: 2020-08-02T10:46:37.388Z
title: Ubuntu18.04 sudo apt update无法解析域名的解决方案
description: 拿起了封尘已久的ThinkPad，输入 sudo apt update 的时候，发现这个命令变得不好使了，主要是提示：无法解析域名等相关错误。
quote:
  content: Every saint has a past. Every sinner has a future.
  author: ''
  source: ''
tags:
  - apt update
  - 无法解析域名
---
## 查看NS Server
我们可以看到，大概我们无法对像"cn.archive.ubuntu.com"、"packages.microsoft.com"之类的网站进行域名解析。出现这一问题主要是因为DNS解析有误，或者是DNS未配置。我们可以查看一下DNS Server：
* cat /etc/resolv.conf
```
# This file is managed by man:systemd-resolved(8). Do not edit.
#
# This is a dynamic resolv.conf file for connecting local clients to the
# internal DNS stub resolver of systemd-resolved. This file lists all
# configured search domains.
#
# Run "systemd-resolve --status" to see details about the uplink DNS servers
# currently in use.
#
# Third party programs must not access this file directly, but only through the
# symlink at /etc/resolv.conf. To manage man:resolv.conf(5) in a different way,
# replace this symlink by a static file or a different symlink.
#
# See man:systemd-resolved.service(8) for details about the supported modes of
# operation for /etc/resolv.conf.

nameserver 127.0.0.53
options edns0
search DHCP HOST
```
只有一个DNS Server的地址 127.0.0.53，我们可以采取如下方法给其配置DNS Server。

## 解决方案：

### 重启会失效
我们只需要加入DNS服务器地址，让其能够自动去解析即可。不过有个问题就是重启以后可能会失效，需要重新对其进行配置。

* sudo vim /etc/resolv.conf # 添加如下内容
```
nameserver 8.8.8.8
nameserver 8.8.4.4
nameserver 127.0.0.1
```
* 输入Esc，:wq，保存并退出
* sudo /etc/init.d/networking restart

我们再输入 sudo apt update 进行更新即可。

### 永久有效
1. sudo apt install resolvconf
2. sudo vim /etc/resolvconf/resolv.conf.d/base

> 在里面插入：
```
nameserver 8.8.8.8
nameserver 8.8.4.4
nameserver 127.0.0.1
```
3. 输入Esc，:wq，保存并退出
4. sudo resolvconf -u
5. cat /etc/resolv.conf
```
# Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8)
#     DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN
nameserver 8.8.8.8
nameserver 8.8.4.4
```
在这里，我还要提一点相关内容。虽然我按照方案二并没有达到想要的这种结果(理论上应该是没问题的)，可能是因为我这边配置全局代理，让它默认自动走本地代理路线，所以DNS Server解析的地址为127.0.0.1，不过至少已经可以使用了，如果方案二行不通的同学，你可以采用方案一，稍微麻烦一点，每次都要进行修改罢了。
## 最终结果如下
```
#( 09/08/19@ 2:58下午 )( python@Sakura ):~/下载/shadowsocksr@manyuser✔
   sudo apt update                    
忽略:1 http://dl.google.com/linux/chrome/deb stable InRelease
命中:2 http://dl.google.com/linux/chrome/deb stable Release                        
获取:3 http://archive.ubuntukylin.com:10006/ubuntukylin xenial InRelease [18.1 kB] 
获取:4 http://packages.microsoft.com/repos/vscode stable InRelease [3,181 B]       
命中:6 http://ppa.launchpad.net/obsproject/obs-studio/ubuntu bionic InRelease      
命中:7 https://packages.microsoft.com/ubuntu/18.04/prod bionic InRelease           
获取:8 http://packages.microsoft.com/repos/vscode stable/main amd64 Packages [139 kB]
命中:9 http://cz.archive.ubuntu.com/ubuntu bionic InRelease                        
命中:10 http://cn.archive.ubuntu.com/ubuntu bionic InRelease                       
命中:11 http://ppa.launchpad.net/ondrej/php/ubuntu bionic InRelease                
命中:12 https://download.sublimetext.com apt/stable/ InRelease                     
获取:13 http://cn.archive.ubuntu.com/ubuntu bionic-updates InRelease [88.7 kB]     
命中:14 http://ppa.launchpad.net/openjdk-r/ppa/ubuntu bionic InRelease             
命中:15 http://ppa.launchpad.net/openshot.developers/ppa/ubuntu bionic InRelease   
命中:16 http://ppa.launchpad.net/ubuntu-toolchain-r/test/ubuntu bionic InRelease   
命中:17 http://ppa.launchpad.net/webupd8team/java/ubuntu bionic InRelease          
获取:18 http://cn.archive.ubuntu.com/ubuntu bionic-security InRelease [88.7 kB]    
获取:19 http://cn.archive.ubuntu.com/ubuntu bionic-proposed InRelease [242 kB]     
命中:20 https://mirrors.ustc.edu.cn/docker-ce/linux/ubuntu bionic InRelease        
获取:21 http://cn.archive.ubuntu.com/ubuntu bionic-updates/main amd64 DEP-11 Metadata [285 kB]
获取:22 http://cn.archive.ubuntu.com/ubuntu bionic-updates/main DEP-11 48x48 Icons [70.9 kB]
获取:23 http://cn.archive.ubuntu.com/ubuntu bionic-updates/main DEP-11 64x64 Icons [140 kB]
获取:24 http://cn.archive.ubuntu.com/ubuntu bionic-updates/multiverse amd64 DEP-11 Metadata [2,464 B]
获取:25 http://cn.archive.ubuntu.com/ubuntu bionic-updates/universe amd64 DEP-11 Metadata [253 kB]
获取:26 http://cn.archive.ubuntu.com/ubuntu bionic-updates/universe DEP-11 48x48 Icons [197 kB]
获取:27 http://cn.archive.ubuntu.com/ubuntu bionic-updates/universe DEP-11 64x64 Icons [447 kB]
获取:28 http://cn.archive.ubuntu.com/ubuntu bionic-security/main amd64 DEP-11 Metadata [22.7 kB]
获取:29 http://cn.archive.ubuntu.com/ubuntu bionic-security/main DEP-11 48x48 Icons [10.4 kB]
获取:30 http://cn.archive.ubuntu.com/ubuntu bionic-security/main DEP-11 64x64 Icons [31.7 kB]
获取:31 http://cn.archive.ubuntu.com/ubuntu bionic-security/multiverse amd64 DEP-11 Metadata [2,464 B]
获取:32 http://cn.archive.ubuntu.com/ubuntu bionic-security/universe amd64 DEP-11 Metadata [42.1 kB]
获取:33 http://cn.archive.ubuntu.com/ubuntu bionic-security/universe DEP-11 48x48 Icons [16.4 kB]
获取:34 http://cn.archive.ubuntu.com/ubuntu bionic-security/universe DEP-11 64x64 Icons [111 kB]
获取:35 http://cn.archive.ubuntu.com/ubuntu bionic-proposed/main amd64 DEP-11 Metadata [7,160 B]
已下载 2,220 kB，耗时 35秒 (63.8 kB/s)                                             
正在读取软件包列表... 完成
正在分析软件包的依赖关系树       
正在读取状态信息... 完成       
有 383 个软件包可以升级。请执行 ‘apt list --upgradable’ 来查看它们。
```

